# SPA/SEO/SSR

## 前后端分离

传统的web前后端开发流程多数是前端将页面写好，返给后端，由后端将页面继承到项目中去。进而引出一个前后端耦合的问题。首先，对于后端来说，不仅要写后端逻辑，还需要集成前端页面，而对于前端来说，并不是比较容易地就能看到页面渲染出来的样子，开发调试也不便捷。

也就是由于前后端的高耦合，使得任何一方的变化都可能会影响到另一方，为了解决这个问题，前后端分离应运而生。

### 基本概念：

前后端通过AJAX接口进行数据交互，目前比较常˙见的是后端直接将数据以JSON的格式返回给前端，前端根据这些数据操作DOM。

### 主要优点

- 分工明确，前后端各司其职，后端专注业务逻辑和功能的实现，前端专注页面的设计
- 接口明确，可以实现并行开发，在后端接口没有实现好之前，前端完全可以自己通过Node.js的Express和koa等web框架模拟接口，提供测试数据
- 减少耦合，提高diamante复用性和开发效率

在前后端分离中，后端一般提供RESTful API，并将数据以JSON格式返回；而前端一般使用的页面架构就是SPA。

## SPA

SAP（SinglePage Web Application），即就是单页面应用。SPA是一种网络应用程序（WebAPP）模型。在传统的网站中，不同的页面之间的切换都是直接从服务器加载一整个新的页面，而在SPA这个模型中，是通过动态地重写页面的部分来与用户交互的，即单页面跳转仅刷新局部资源（发生变化的部分），公共资源（js、css）仅需加载一次，从而避免了过多的数据交换，响应速度比较高。常用于pc端官网、购物等网站。如图：
[img_1](https://github.com/HUANYU2015/articles/blob/master/spa.png)

### 目前常见的SPA框架

- Angular
- React
- Vue

### SPA优点

- 页面之间切换可以很快
- 一定程度上减轻了后端服务器压力（不管页面逻辑和渲染）
- 后端程序只需要提供API，完全不用管客户端是web界面还是移动端界面

### SPA的缺点

- 首屏打开速度很慢，因为用户首次打开应用，会从服务端加载spa框架及应用程序代码，然后再渲染页面
- 对搜索引擎不友好，不利于爬虫爬取数据

根据这几个缺点，便引出了SEO和SSR两个概念。

## SEO

SEO（Search Engine Optimization），即搜索引擎优化，是一种通过了解搜索引擎的运作规则（如何抓取网站页面，如何索引以及根据特定的关键字展现搜索结果排序）来调整网站，以提高该网站在搜索引擎中某些关键词的搜索结果排名。

### 常用技术

搜索引擎优化的技术大致分为两种：白帽技术和黑帽技术。

### SPA与SEO的冲突

由于SPA不利于SEO，因为就目前而言，部分搜索引起如Google、Bing等，其爬虫技术虽然已经支持执行JS甚至可以通过ajax获取数据，但是对于异步数据的支持还是不足，Vue SSR中写到：
> 如果你的应用程序初始展示loading菊花图，然后通过ajax获取内容，抓取工具并不会等待异步完成后在行抓却页面内容。

前面说到在SPA应用中，通过ajax获取数据，因而这里就难以保证页面能够被搜索引擎正常收录到。并且有一些搜索引擎并不支持执行js以及通过ajax获取数据，便更不利于SEO了。为此SSR就派上用场了。

## SSR

### 概念

SSR是Server-Side Rendering（服务端渲染）的缩写，在普通的SAP中，一般是将框架及网站页面代码发送到浏览器，然后在浏览器中生成和操作DOM（这里也是首次访问SPA网站在同等宽带及网络延迟下比传统在后端生成HTML发送到浏览器更慢的主要原因），但其实也可以将SPA应用打包到服务器上，在服务器上渲染出HTML，发送到浏览器，这样的HTML页面还不具备交互能力，所以还需要和SPA框架配合，在浏览器上“混合”成可交互的应用程序。所以，只要能合理地运用SSR技术。不仅能够在一定程度上解决首屏慢的问题，还能获得较好的SEO体验。

### SSR的优点

- 更快的响应时间，不用等待所有JS都加载完成，浏览器便能显示比较完整的页面。
- 可以将SEO的关键信息直接在后台就渲染成HTML，从而保证搜索引擎的爬虫能够爬取到关键数据。

### SSR的缺点

- 相对于仅仅需要提供静态文件的服务器，SSR中使用的渲染程序自然会占用更多的CPU和内存资源
- 一些常用的浏览器API可能无法正常使用，比如window、docment和alert等，如果使用的话需要对运行的环境加以判断
- 开发调试会有一些麻烦，因为涉及了浏览器及服务器，对于SPA的一些组件的生命周期的管理会变得复杂
- 可能会由于某些因素导致服务器端渲染的结果与浏览器端的结果不一致。

### SSR常用框架

- React的Next
- Vue的Nuxt

## 总结

- 前后端分离降低了两者的耦合度，提高了开发效率
- SPA是前后端分离中前端的一种解决方案
- SEO对很多网站很重要，但普通的SPA又不利于SEO
- SSR的出现一定程度上解决了SPA中首屏慢的问题，又极大减少了SPA对SEO的不利影响
