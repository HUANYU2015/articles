# vue-router

## å®‰è£…

---

### ç›´æ¥ä¸‹è½½/CDN

### NPM

ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æˆ–æ˜¯ä½¿ç”¨vue-cliè‡ªåŠ¨å®‰è£…

~~~ xml
npm install vue-router
~~~

å¦‚æœåœ¨ä¸€ä¸ªæ¨¡å—åŒ–å·¥ç¨‹ä¸­ä½¿ç”¨å®ƒï¼Œå¿…é¡»è¦é€šè¿‡Vue.use()æ˜ç¡®åœ°å®‰è£…è·¯ç”±åŠŸèƒ½ï¼š

~~~ javascript
import Vue from 'vue'
import VueRouter from 'vue-router'
Vue.use(VueRouter)
~~~

### æ„å»ºå¼€å‘æ¿

å¦‚æœä½ æƒ³ä½¿ç”¨æœ€æ–°çš„å¼€å‘ç‰ˆï¼Œä½ å¯ä»¥ä»GitHubä¸Šç›´æ¥cloneï¼Œç„¶åè‡ªå·±buildä¸€ä¸ªvue-router

~~~ xml
git clone https://github.com/vuejs/vue-router.git node_modules/vue-router
cd node_modules/vue-router
npm install
run build
~~~

## ä»‹ç»

---

> $ç‰ˆæœ¬è¯´æ˜$
> å¯¹äºTypeScriptç”¨æˆ·æ¥è¯´ï¼Œ**vue-router@3.0+**ä¾èµ–**vue@2.5+**ï¼Œåä¹‹äº¦ç„¶ã€‚

Vue Routeræ˜¯Vue.jså®˜æ–¹çš„è·¯ç”±ç®¡ç†å™¨ã€‚å®ƒå’ŒVue.jsçš„æ ¸å¿ƒæ·±åº¦é›†æˆï¼Œè®©æ„å»ºå•é¡µé¢åº”ç”¨å˜å¾—æ˜“å¦‚åæŒã€‚å®ƒå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š

- åµŒå¥—çš„è·¯ç”±/è§†å›¾è¡¨
- æ¨¡å—åŒ–ã€åŸºäºç»„ä»¶çš„è·¯ç”±é…ç½®
- è·¯ç”±å‚æ•°ã€æŸ¥è¯¢ã€é€šé…ç¬¦
- åŸºäºVue.jsè¿‡åº¦ç³»ç»Ÿçš„è§†å›¾è¿‡åº¦æ•ˆæœ
- ç»†ç²’åº¦çš„å¯¼èˆªæ§åˆ¶
- å¸¦æœ‰è‡ªåŠ¨æ¿€æ´»çš„CSS classçš„é“¾æ¥
- HTML5å†å²æ¨¡å¼æˆ–hashæ¨¡å¼ï¼Œåœ¨IE9ä¸­è‡ªåŠ¨é™çº§
- **è‡ªåŠ¨çš„æ»šåŠ¨æ¡è¡Œä¸º**

## åŸºç¡€

---

### èµ·æ­¥

ä½¿ç”¨Vue.js+Vue Router åˆ›å»ºå•é¡µåº”ç”¨ï¼Œéå¸¸ç®€å•ã€‚ä½¿ç”¨Vue.jsï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆç»„ä»¶æ¥æ„æˆåº”ç”¨ç¨‹åºï¼Œå½“ä½ è¦æŠŠVue Routeræ·»åŠ è¿›æ¥ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼š

- åœ¨/router.js/index.jsä¸­å°†ç»„ä»¶ï¼ˆcomponentï¼‰æ˜ å°„åˆ°è·¯ç”±ï¼ˆroutersï¼‰ï¼Œå³åˆ›å»ºè·¯ç”±å®ä¾‹ `VueRouter` ï¼Œå¹¶å®šä¹‰è·¯ç”± `routers`
- åœ¨ç¨‹åºå…¥å£æ–‡ä»¶ `main.js` ä¸­é€šè¿‡ `router` é€‰é¡¹æ³¨å…¥å‰é¢å·²åˆ›å»ºçš„è·¯ç”±å®ä¾‹
- åœ¨éœ€è¦ä½¿ç”¨è·¯ç”±çš„ç»„ä»¶ä¸­ä½¿ç”¨ `<router-link>` æ ‡ç­¾çš„ `to` å±æ€§æŒ‡å‘ç›¸å…³è·¯ç”±
- åœ¨é¡µé¢å…¥å£æ–‡ä»¶ï¼ˆ `App.vue` ï¼‰ä¸­ä½¿ç”¨ `<router-view>` æŒ‡æ˜è·¯ç”±å‡ºå£ï¼Œå³å‘ŠçŸ¥è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶çš„æ¸²æŸ“ä½ç½®

é€šè¿‡æ³¨å…¥è·¯ç”±å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•ç»„ä»¶å†…é€šè¿‡ `this.$router` è®¿é—®è·¯ç”±å™¨ï¼Œé€šè¿‡ `this.$route` è®¿é—®å½“å‰è·¯ç”±ã€‚

 > æ³¨æ„ï¼šå½“ `<router-link>` å¯¹åº”çš„è·¯ç”±åŒ¹é…æˆåŠŸï¼Œå°†è‡ªåŠ¨è®¾ç½®classå±æ€§å€¼ `.router-link-active` ã€‚

### åŠ¨æ€è·¯ç”±åŒ¹é…

æˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠæŸç§æ¨¡å¼åŒ¹é…åˆ°æ‰€æœ‰è·¯ç”±ï¼Œå…¨éƒ¨æ˜ å°„åˆ°åŒä¸€ä¸ªç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ª `User` ç»„ä»¶ï¼Œå¯¹äºæ‰€æœ‰IDå„ä¸ç›¸åŒçš„ç”¨æˆ·ï¼Œéƒ½è¦ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ¥æ¸²æŸ“ã€‚é‚£ä¹ˆï¼Œä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œå¯ä»¥åœ¨ `vue-router` çš„è·¯ç”±è·¯å¾„ä¸­ä½¿ç”¨ `åŠ¨æ€è·¯å¾„å‚æ•°ï¼ˆdynamic segmentï¼‰` ã€‚

 ```javascript
 const User = {
     template: '<div>User</div>'
 }

 const router = new VueRouter({
     routers: [
        // åŠ¨æ€è·¯å¾„å‚æ•° ä»¥å†’å·å¼€å¤´
         {path: '/user/:id', component: User}
     ]
 })
 ```

ç°åœ¨ï¼Œå‘ `/user/foo` å’Œ `/user/bar` éƒ½å°†æ˜ å°„åˆ°ç›¸åŒçš„è·¯ç”±ã€‚

ä¸€ä¸ª **è·¯å¾„å‚æ•°**ä½¿ç”¨ `:` æ ‡è®°ã€‚å½“åŒ¹é…åˆ°ä¸€ä¸ªè·¯ç”±æ—¶ï¼Œå‚æ•°å€¼ä¼šè¢«è®¾ç½®åˆ° `this.$route.params` ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¯ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–° `User` çš„æ¨¡æ¿ï¼Œè¾“å‡ºå½“å‰ç”¨æˆ·çš„IDï¼š

 ```javascript
 const User = {
     template: '<div>{{$route.params.id}}</div>'
 }
 ```

ä½ å¯ä»¥åœ¨ä¸€ä¸ªè·¯ç”±ä¸­è®¾ç½®å¤šæ®µ **è·¯å¾„å‚æ•°**ï¼Œå¯¹åº”çš„å€¼éƒ½ä¼šè®¾ç½®åˆ° `$route.params` ä¸­ã€‚ä¾‹å¦‚ï¼š

| æ¨¡å¼                          | åŒ¹é…è·¯å¾„            | $route.params                        |
| :---------------------------- | :------------------ | :----------------------------------- |
| /user/:username               | /user/evan          | `{username: â€˜evanâ€™}`               |
| /user/:username/post/:post_id | /user/evan/post/123 | `{username: 'evan', post_id: '123'}` |

é™¤äº† `$route.params` å¤–ï¼Œ `$route` å¯¹è±¡è¿˜æä¾›äº†å…¶ä»–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå¦‚ `$route.query` (å¦‚æœURLä¸­æœ‰æŸ¥è¯¢å‚æ•°)ã€ `$route.hash` ç­‰ç­‰ã€‚

#### å“åº”è·¯ç”±å‚æ•°çš„å˜åŒ–

å½“ä½¿ç”¨è·¯ç”±å‚æ•°æ—¶ï¼Œæ¯”å¦‚ä» `/user/foo` å¯¼èˆªåˆ° `/user/bar` ï¼Œ **åŸæ¥çš„ç»„ä»¶å®ä¾‹å°†ä¼šè¢«å¤ç”¨**ã€‚å› ä¸ºä¸¤ä¸ªè·¯ç”±éƒ½æ¸²æŸ“åŒä¸ªç»„ä»¶ï¼Œæ¯”èµ·é”€æ¯å†åˆ›å»ºï¼Œå¤ç”¨æ›´åŠ é«˜æ•ˆã€‚ **ä¸è¿‡ï¼Œè¿™ä¸ªæ„å‘³ç€ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸ä¼šå†è¢«è°ƒç”¨**ã€‚

å¤ç”¨ç»„ä»¶æ—¶ï¼Œå¦‚éœ€å¯¹è·¯ç”±å‚æ•°çš„å˜åŒ–åšå‡ºå“åº”ï¼Œå¯ä»¥ç®€å•åœ°watch(æ£€æµ‹å˜åŒ–) `$route` å¯¹è±¡ï¼š

~~~ javascript
const User = {
    template: '...',
    watch: {
        '$route' (to, from) {
            // å¯¹è·¯ç”±å˜åŒ–åšå‡ºå“åº”...
        }
    }
}
~~~

æˆ–è€…ä½¿ç”¨2.2ä¸­å¼•å…¥çš„ `beforeRouteUpdate` **å¯¼èˆªå®ˆå«**ï¼š

~~~ javascript
const User = {
    template: '...',
    beforeRouteUpdate (to, from, next) {
        // react to route changes...
        // don't forget to call next()
    }
}
~~~

#### æ•è·æ‰€æœ‰è·¯ç”±æˆ–è€…404 Not foundè·¯ç”±

å¸¸è§„å‚æ•°åªä¼šåŒ¹é…è¢« `/` åˆ†éš”çš„URLç‰‡æ®µä¸­çš„å­—ç¬¦ã€‚å¦‚æœæƒ³åŒ¹é…ä»»æ„è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼ˆ`*`ï¼‰ï¼š

~~~ javascript
{
    // ä¼šåŒ¹é…æ‰€æœ‰è·¯å¾„
    path: '*'
}, {
    // ä¼šåŒ¹é…ä»¥ â€˜ã€user-â€™å¼€å¤´çš„ä»»æ„è·¯å¾„
    path: '/user-*'
}
~~~

ä½¿ç”¨é€šé…ç¬¦è·¯ç”±éœ€è¦ç¡®ä¿è·¯ç”±çš„é¡ºåºæ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å«æœ‰é€šé…ç¬¦çš„è·¯ç”±åº”è¯¥æ”¾åœ¨æœ€åã€‚

è·¯ç”± `{path: '*'}` é€šå¸¸ç”¨äºå®¢æˆ·ç«¯**404é”™è¯¯**ã€‚å¦‚æœä½ ä½¿ç”¨äº†Historyæ¨¡å¼ï¼Œéœ€è¦ç¡®ä¿[æ­£ç¡®é…ç½®æœåŠ¡å™¨](#HTML\ Historyæ¨¡å¼)ã€‚

å½“ä½¿ç”¨ä¸€ä¸ªé€šé…ç¬¦æ—¶ï¼Œ`$route.params` ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªåä¸º `pathMatch` å‚æ•°ã€‚å®ƒåŒ…å«äº†URLé€šè¿‡é€šé…ç¬¦è¢«åŒ¹é…çš„éƒ¨åˆ†ï¼š

~~~ javascript
// ç»™å‡ºä¸€ä¸ªè·¯ç”± {path: 'user-*'}
this.$router.push('/user-admin')
this.$route.params.pathMatch // â€˜adminâ€™
// ç»™å‡ºä¸€ä¸ªè·¯ç”± {path: '*'}
this.$router.push('/non-existing')
this.$route.params.pathMatch // '/non-existing'
~~~

#### é«˜çº§åŒ¹é…æ¨¡å¼

`vue-router` ä½¿ç”¨**path-to-regexp**ä½œä¸ºè·¯å¾„åŒ¹é…å¼•æ“ï¼Œæ‰€ä»¥æ”¯æŒå¾ˆå¤šé«˜çº§åŒ¹é…æ¨¡å¼ï¼Œå¦‚ï¼šå¯é€‰çš„åŠ¨æ€è·¯å¾„å‚æ•°ã€åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œç”šè‡³æ˜¯è‡ªå®šä¹‰æ­£åˆ™åŒ¹é…ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹å®ƒçš„[æ–‡æ¡£](https://github.com/pillarjs/path-to-regexp#parameters)å­¦ä¹ é«˜æ°çš„è·¯å¾„åŒ¹é…ï¼Œè¿˜æœ‰[è¿™ä¸ªä¾‹å­](https://github.com/vuejs/vue-router/blob/dev/examples/route-matching/app.js)å±•ç¤º `vue-router` æ€ä¹ˆä½¿ç”¨è¿™ç±»åŒ¹é…ã€‚

#### åŒ¹é…ä¼˜å…ˆçº§

æœ‰æ—¶ï¼ŒåŒä¸€ä¸ªè·¯å¾„å¯ä»¥åŒ¹é…å¤šä¸ªè·¯ç”±ï¼Œæ­¤æ—¶ï¼ŒåŒ¹é…çš„ä¼˜å…ˆçº§æŒ‰ç…§è·¯ç”±çš„å®šä¹‰é¡ºåºï¼šè°å…ˆå®šä¹‰çš„ï¼Œè°çš„ä¼˜å…ˆçº§å°±æ›´é«˜ã€‚

### åµŒå¥—è·¯ç”±

<!-- [æµ‹è¯•](#è¿›é˜¶) -->
å®é™…åº”ç”¨ç•Œé¢ï¼Œé€šå¸¸ç”±å¤šå±‚åµŒå¥—çš„ç»„ä»¶ç»„åˆè€Œæˆã€‚åŒæ ·ï¼ŒURLä¸­å„æ®µåŠ¨æ€è·¯å¾„ä¹ŸæŒ‰æŸç§ç»“æ„å¯¹åº”åµŒå¥—çš„å„å±‚ç»„ä»¶ï¼Œå¦‚ï¼š

~~~ javascript
/user/foo/profile                     /user/foo/posts
+------------------+                  +-----------------+
| User             |                  | User            |
| +--------------+ |                  | +-------------+ |
| | Profile      | |  +------------>  | | Posts       | |
| |              | |                  | |             | |
| +--------------+ |                  | +-------------+ |
+------------------+                  +-----------------+
~~~

å€ŸåŠ© `vue-router` ï¼Œä½¿ç”¨åµŒå¥—è·¯ç”±é…ç½®ï¼Œå°±å¯ä»¥å¾ˆç®€å•åœ°è¡¨è¾¾è¿™ç§å…³ç³»ã€‚

æ¥ç€ä¸ŠèŠ‚åˆ›å»ºçš„app:

~~~ html
<div id="app">
  <router-view></router-view>
</div>
~~~

~~~ javascript
const User = {
    template: '<div>User {{$route.params.id}}</div>'
}

const router = new VueRouter({
    routers: [
        {path: '/user/:id', component: User}
    ]
})
~~~

è¿™é‡Œçš„ `<router-view>` æ˜¯æœ€é¡¶å±‚çš„å‡ºå£ï¼Œæ¸²æŸ“æœ€é«˜çº§è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶ã€‚åŒæ ·çš„ï¼Œä¸€ä¸ªè¢«æ¸²æŸ“çš„ç»„ä»¶ä¹Ÿå¯ä»¥åŒ…å«è‡ªå·±çš„åµŒå¥— `<router-view>` ã€‚ä¾‹å¦‚ï¼Œåœ¨ `User` ç»„ä»¶çš„æ¨¡æ¿ä¸­æ·»åŠ ä¸€ä¸ª `<router-view>` ï¼š

~~~ javascript
const User = {
    template: '
        <div class="user">
            <h2>User {{$route.params.id}}</h2>
            <router-view></router-view>
        </div>
    '
}
~~~

è¦åœ¨åµŒå¥—çš„å‡ºå£ä¸­æ¸²æŸ“ç»„ä»¶ï¼Œéœ€è¦åœ¨ `VueRouter` çš„å‚æ•°ä¸­ä½¿ç”¨ `children` é…ç½®ï¼š

~~~ javascript
const router = new VueRouter({
    router: [
        {
            path: '/user/:id', component: User,
            children: [
                {
                    // å½“ /user/:id/profileåŒ¹é…æˆåŠŸ
                    // UserProfileä¼šè¢«æ¸²æŸ“åœ¨Userçš„<router-view>ä¸­
                    path: 'profile',
                    component: UserProfile
                }, {
                    // å½“/user/:id/postsåŒ¹é…æˆåŠŸ
                    // UserPostsä¼šè¢«æ¸²æŸ“åœ¨Userçš„<router-view>ä¸­
                    path: 'posts',
                    component: UserPosts
                }
            ]
        }
    ]
})
~~~

> æ³¨æ„ï¼šä»¥ `/` å¼€å¤´çš„åµŒå¥—è·¯å¾„ä¼šè¢«å½“åš**æ ¹è·¯å¾„**ã€‚è¿™è®©ä½ å……åˆ†åœ°ä½¿ç”¨åµŒå¥—ç»„ä»¶ï¼Œè€Œæ— é¡»è®¾ç½®åµŒå¥—è·¯å¾„ã€‚

`children` é…ç½®å°±åƒ `routers` é…ç½®ä¸€æ ·çš„è·¯å¾„é…ç½®å‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥åµŒå¥—å¤šå±‚è·¯ç”±ã€‚

æ­¤æ—¶ï¼ŒåŸºäºä¸Šé¢çš„é…ç½®ï¼Œå½“è®¿é—® `/user/foo` æ—¶ï¼ŒUserçš„å‡ºå£æ˜¯ä¸ä¼šæ¸²æŸ“ä»»ä½•ä¸œè¥¿çš„ï¼Œå› ä¸ºæ²¡æœ‰åŒ¹é…åˆ°åˆé€‚çš„å­è·¯ç”±ã€‚å¦‚æœæƒ³è¦æ¸²æŸ“ç‚¹ä»€ä¹ˆï¼Œå¯ä»¥æä¾›ä¸€ä¸ªç©ºçš„å­è·¯ç”±ï¼š

~~~ javascript
const router = new VueRouter({
    routers: [
        {
            path: '/user/:id', component: User,
            children: [
                // å½“ /user/:id åŒ¹é…æˆåŠŸï¼Œ
                // UserHome ä¼šè¢«æ¸²æŸ“åœ¨ User çš„<router-view>ä¸­
                {path: '', component: UserHome}

                // ...å…¶ä»–å­è·¯ç”±
            ]
        }
    ]
})
~~~

æä¾›ä»¥ä¸Šæ¡ˆä¾‹çš„å¯è¿è¡Œä»£ç è¯·[**ç§»æ­¥è¿™é‡Œ**](https://jsfiddle.net/yyx990803/L7hscd8h/)ã€‚

### ç¼–ç¨‹å¼å¯¼èˆª

é™¤äº†ä½¿ç”¨ `<router-link>` åˆ›å»ºaæ ‡ç­¾æ¥å®šä¹‰å¯¼èˆªé“¾æ¥ï¼Œè¿˜å¯ä»¥å€ŸåŠ©routerçš„å®ä¾‹æ–¹æ³•ï¼Œé€šè¿‡ç¼–å†™ä»£ç æ¥å®ç°ã€‚

#### router.push(location, onComplete?, onAbort?)

> æ³¨æ„ï¼šåœ¨Vueå®ä¾‹å†…éƒ¨ï¼Œå¯ä»¥é€šè¿‡ `$router` è®¿é—®è·¯ç”±å®ä¾‹ã€‚å› æ­¤ä½ å¯ä»¥è°ƒç”¨ `this.$router.push` ã€‚

æƒ³è¦å¯¼èˆªåˆ°ä¸åŒçš„URLï¼Œåˆ™ä½¿ç”¨ `router.push` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå‘historyæ ˆæ·»åŠ ä¸€ä¸ªæ–°çš„è®°å½•ğŸ“ã€‚æ‰€ä»¥ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®æ—¶ï¼Œåˆ™å›åˆ°ä¹‹å‰çš„URLã€‚

å½“ä½ ç‚¹å‡» `<router-link>` æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨å†…éƒ¨è°ƒç”¨ï¼Œæ•…ç‚¹å‡» `<router-link :to="...">` ç­‰åŒä¸è°ƒç”¨ `router.push(...)` ã€‚

| **å£°æ˜å¼**                | **ç¼–ç¨‹å¼**         |
| :------------------------ | :----------------- |
| `<router-link :to="...">` | `router.push(...)` |

è¯¥æ–¹æ³•çš„å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è·¯å¾„ï¼Œæˆ–è€…ä¸€ä¸ªæè¿°åœ°å€çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š

~~~ javascript
// å­—ç¬¦ä¸² -> /home
router.push('home')

// å¯¹è±¡ -> /home
router.push({path: 'home'})

// å‘½åçš„è·¯ç”± -> /user/123
router.push({name: 'user', params: {userId: '123'}})

// å¸¦æŸ¥è¯¢å‚æ•°ï¼Œ -> /register?plan=private
router.push({path: 'register', query: {plan: 'private'}})
~~~

> æ³¨æ„ï¼šå¦‚æœæä¾›äº† **`path`**ï¼Œ**`params`** ä¼šè¢«å¿½ç•¥ï¼ˆä¸Šè¿°ä¾‹å­ä¸­çš„ `query` ä¸å±äºè¿™ç§æƒ…å†µï¼‰ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹ä¸€äº›æ–¹å¼ä½œä¸ºæ›¿ä»£ï¼š

~~~ javascript
const userId = '123'
router.push({name: 'user', params: {userId}}) // -> /user/123
router.push({path: '/user/${userId}'}) // -> /user/123

// è¿™é‡Œçš„ params ä¸ç”Ÿæ•ˆ
router.push({path: '/user', params: {userId}}) // -> /user
~~~

åŒæ ·çš„è§„åˆ™ä¹Ÿé€‚ç”¨äº `router-link` ç»„ä»¶çš„ `to` å±æ€§ã€‚

åœ¨2.2.0+ï¼Œå‡½æ•° `router.push` å’Œ `router.replace` ä¸­ï¼Œæä¾›çš„ `onComplete` å’Œ `onAbort` å›è°ƒä½œä¸ºç¬¬äºŒã€ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚å‰è€…å°†ä¼šåœ¨å¯¼èˆªæˆåŠŸå®Œæˆæ—¶ï¼ˆåœ¨æ‰€æœ‰çš„å¼‚æ­¥é’©å­è¢«è§£æä¹‹åï¼‰è¿›è¡Œç›¸åº”çš„è°ƒç”¨ï¼Œåè€…åœ¨å¯¼èˆªæˆåŠŸç»ˆæ­¢æ—¶ï¼ˆå¯¼èˆªåˆ°ç›¸åŒçš„è·¯ç”±ã€æˆ–åœ¨å½“å‰å¯¼èˆªå®Œæˆä¹‹å‰å¯¼èˆªåˆ°å¦ä¸€ä¸ªä¸åŒçš„è·¯ç”±ï¼‰è¿›è¡Œç›¸åº”çš„è°ƒç”¨ã€‚

#### router.replace(location, onComplete?, onAbort?)

è·Ÿ `router.push` å¾ˆåƒï¼Œä½ç§»çš„ä¸åŒå°±æ˜¯ï¼Œå®ƒä¸ä¼šåƒhistoryæä»·æ–°çºªå½•ï¼Œè€Œæ˜¯æ›¿æ¢æ‰å½“å‰çš„historyè®°å½•ã€‚

| **å£°æ˜å¼**                        | **ç¼–ç¨‹å¼**            |
| :-------------------------------- | :-------------------- |
| `<router-link :to="..." replace>` | `router.replace(...)` |

#### router.go(n)

è¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä½œç”¨æ˜¯åœ¨historyè®°å½•ä¸­å‘å‰åå‘åç§»åŠ¨næ­¥ï¼Œç±»ä¼¼ `window.histroy.go(n)` ã€‚

~~~ javascript
// åœ¨æµè§ˆå™¨è®°å½•ä¸­å‰è¿›ä¸€æ­¥ï¼Œç­‰åŒäºhistory.forword()
router.go(1)

// åé€€ä¸€æ­¥è®°å½•ï¼Œç­‰åŒäºhistory.back()
router.go(-1)

// å‰è¿› 3 æ­¥è®°å½•
router.go(3)

// å¦‚æœhistoryè®°å½•ä¸å¤Ÿç”¨ï¼Œå°±é»˜é»˜åœ°å¤±è´¥
router.go(-100)
router.go(100)
~~~

#### æ“ä½œHistory

æ³¨æ„ `router.push` `router.replace` å’Œ `router.go` ä¸`window.histroy.pushState` `window.history.replaceState` å’Œ  `window.history.go` æ¯”è¾ƒç›¸åƒï¼Œå®é™…ä¸Šå®ƒä»¬ç¡®å®å››æ•ˆä»¿ `window.history` **API**çš„ã€‚

æ­¤å¤–ï¼ŒVue Router çš„å¯¼èˆªæ–¹æ³•ï¼ˆpush/replace/goï¼‰åœ¨å„ç±»è·¯ç”±æ¨¡å¼ï¼ˆ`history` `hash`å’Œ`abstact`ï¼‰ä¸‹è¡¨ç°ä¸€è‡´ã€‚

### å‘½åè·¯ç”±

æœ‰æ—¶å€™ï¼Œé€šè¿‡ä¸€ä¸ªåç§°æ¥è¯†åˆ«ä¸€ä¸ªè·¯ç”±æ˜¾å¾—æ›´æ–¹ä¾¿ä¸€äº›ï¼Œç‰¹åˆ«æ˜¯åœ¨é“¾æ¥ä¸€ä¸ªè·¯ç”±ï¼Œæˆ–è€…æ‰§è¡Œä¸€äº›è·³è½¬çš„æ—¶å€™ã€‚å¯ä»¥åœ¨åˆ›å»ºRouterå®ä¾‹çš„æ—¶å€™ï¼Œåœ¨ routers é…ç½®ä¸­ç»™æŸä¸ªè·¯ç”±è®¾ç½®åç§°ã€‚

~~~ javascript
const router = new VueRouter({
    routers: [
        {
            path: '/user/:userId',
            name: 'user',
            component: User
        }
    ]
})
~~~

è¦é“¾æ¥ä¸€ä¸ªå‘½åè·¯ç”±ï¼Œå¯ä»¥ç»™ `router-link` çš„ `to` å±æ€§ä¼ ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€ä¸ª name å±æ€§ï¼š

~~~ javascript
// -> /user/123
<router-link :to="{name: 'user', params: {userId: 123}}">User</router-link>
~~~

ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç å®ç°ï¼š

~~~ javascript
router.push({name: 'user', params: {userId: 123}})
~~~

è¿™ä¸¤ç§æ–¹å¼éƒ½ä¼šæŠŠè·¯ç”±å¯¼èˆªåˆ° `/user/123` è·¯å¾„ã€‚

å®Œæ•´ä¾‹å­è¯·[**ç§»æ­¥è¿™é‡Œ**](https://github.com/vuejs/vue-router/blob/dev/examples/named-routes/app.js)ã€‚

### å‘½åè§†å›¾

æœ‰æ—¶å€™éœ€è¦åŒæ—¶ï¼ˆåŒçº§ï¼‰å±•ç¤ºå¤šä¸ªè§†å›¾ï¼Œè€Œä¸æ˜¯åµŒå¥—æ˜¾ç¤ºï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªé¡µé¢ï¼Œå…¶å¸ƒå±€æœ‰ sidebar ï¼ˆä¾§å¯¼èˆªï¼‰å’Œ main ï¼ˆä¸»å†…å®¹ï¼‰ä¸¤ä¸ªè§†å›¾ï¼Œè¿™ä¸ªæ—¶å€™å‘½åè§†å›¾ï¼ˆæ·»åŠ  `name` å±æ€§ï¼‰å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ä½ å¯ä»¥åœ¨ç•Œé¢ä¸­æ‹¥æœ‰å¤šä¸ªå•ç‹¬å‘½åçš„è§†å›¾ï¼Œè€Œä¸æ˜¯å•ç‹¬ä¸€ä¸ªå‡ºå£ã€‚é»˜è®¤ï¼ˆ`default`ï¼‰è§†å›¾ï¼ˆrouter-viewï¼‰ï¼Œå¯æ— éœ€è®¾ç½®nameå±æ€§ã€‚ä»£ç å¦‚ä¸‹ï¼š

~~~ html
<router-view class="view one"></router-view>
<router-view class="view two" name="a"></router-view>
<router-view class="view three" name="b"></router-view>
~~~

å•ä¸ªè§†å›¾ä½¿ç”¨å•ä¸ªç»„ä»¶æ¸²æŸ“ï¼Œå› æ­¤å¯¹äº`åŒä¸€ä¸ªè·¯ç”±`ï¼Œå¤šä¸ªè§†å›¾å°±éœ€è¦å¤šä¸ªç»„ä»¶ã€‚ç¡®ä¿æ­£ç¡®ä½¿ç”¨ `components` é…ç½®ï¼ˆå¤æ•°ï¼‰

~~~ javascript
const router = new VueRouter({
    routers: [
        {
            path: '/',
            components: {
                default: Foo,
                a: Bar,
                b: Baz
            }
        }
    ]
})
~~~

ä»¥ä¸Šæ¡ˆä¾‹ç›¸å…³å¯è¿è¡Œä»£ç è¯·[**ç§»æ­¥è¿™é‡Œ**](https://jsfiddle.net/posva/6du90epg/)

#### åµŒå¥—å‘½åè§†å›¾

å½“é¡µé¢å¸ƒå±€æ¯”è¾ƒå¤æ‚æ—¶ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å‘½åè§†å›¾åˆ›å»ºè§†å›¾åµŒå¥—ã€‚éœ€è¦ç»“åˆåµŒå¥—è·¯ç”±å’Œå‘½åè§†å›¾æ¥å®ç°ã€‚ä»¥ä¸€ä¸ªè®¾ç½®é¢æ¿ä¸ºä¾‹ï¼š

~~~ javascript
/settings/emails                                       /settings/profile
+-----------------------------------+                  +------------------------------+
| UserSettings                      |                  | UserSettings                 |
| +-----+-------------------------+ |                  | +-----+--------------------+ |
| | Nav | UserEmailsSubscriptions | |  +------------>  | | Nav | UserProfile        | |
| |     +-------------------------+ |                  | |     +--------------------+ |
| |     |                         | |                  | |     | UserProfilePreview | |
| +-----+-------------------------+ |                  | +-----+--------------------+ |
+-----------------------------------+                  +------------------------------+
~~~

`Nav` åªæ˜¯ä¸€ä¸ªå¸¸è§„ç»„ä»¶ã€‚
`UserSettings` æ˜¯ä¸€ä¸ªè§†å›¾ç»„ä»¶ã€‚
`UserEmailSubscriptions`ã€`UserProfile`ã€`UserProfilePreview` æ˜¯åµŒå¥—çš„è§†å›¾ç»„ä»¶ã€‚

`UserSettings` ç»„ä»¶ä»£ç å¦‚ä¸‹ï¼š

~~~ javascript
const UserSettings = {
    template: `
    <div class="us">
        <h2>User Settings</h2>
        <UserSettingsNav/>
        <router-view class ="us__content"/>
        <router-view name="helper" class="us__content us__content--helper"/>
</div>
    `,
  components: { UserSettingsNav }
}
~~~

ç„¶åé€šè¿‡è·¯ç”±é…ç½®å®Œæˆå¸ƒå±€ï¼š

~~~ javascript
const router = new VueRouter({
    mode: 'history',
    routers: [
        {
            path: '/settings',
            component: UserSettings,
            children: [{
                path: 'emails',
                component: UserEmailSubscriptions
            }, {
                path: 'profile',
                components: {
                    default: UserProfile,
                    helper: UserProfilePreview
                }
            }]
        }
    ]
})
~~~

ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹è¯·[**ç§»æ­¥è¿™é‡Œ**](https://jsfiddle.net/posva/22wgksa3/)

### é‡å®šå‘å’Œåˆ«å

#### é‡å®šå‘

é‡å®šå‘ä¹Ÿæ˜¯é€šè¿‡ `routers` é…ç½®æ¥å®Œæˆçš„ï¼Œä¸‹é¢çš„ä¾‹å­æ˜¯ä» `/a` é‡å®šå‘åˆ° `/b` ï¼š

~~~ javascript
const router = new VueRouter({
    routers: [
        {path: '/a', redirect: '/b'}
    ]
})
~~~

é‡å®šå‘çš„ç›®æ ‡ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‘½åçš„è·¯ç”±ï¼š

~~~ javascript
const router = new VueRouter({
    routers: [
        {path: '/a', redirect: {name: 'foo'}}
    ]
})
~~~

ç”šè‡³æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›é‡å®šå‘ç›®æ ‡ï¼š

~~~ javascript
const router = new VueRouter({
    routers: [
        {path: '/a', redirect: to => {
            // æ–¹æ³•æ¥æ”¶ ç›®æ ‡è·¯ç”± ä½œä¸ºå‚æ•°
            // return é‡å®šå‘çš„ å­—ç¬¦ä¸²è·¯å¾„æˆ–è·¯å¾„å¯¹è±¡
        }}
    ]
})
~~~

> æ³¨æ„[å¯¼èˆªå®ˆå«](#å¯¼èˆªå®ˆå«)å¹¶æ²¡æœ‰åº”ç”¨åœ¨è·³è½¬è·¯ç”±(from)ä¸Šï¼Œè€Œä»…ä»…åº”ç”¨åœ¨å…¶ç›®æ ‡è·¯ç”±ä¸Š(to)ã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸º /a è·¯ç”±æ·»åŠ ä¸€ä¸ª beforeEach æˆ– beforeLeave å®ˆå«å¹¶ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚
>
> å…¶å®ƒé«˜çº§ç”¨æ³•ï¼Œè¯·å‚è€ƒ[**ä¾‹å­**](https://github.com/vuejs/vue-router/blob/dev/examples/redirect/app.js)ã€‚

#### åˆ«å

â€œé‡å®šå‘â€å³ï¼Œå½“ç”¨æˆ·è®¿é—® `/a` æ—¶ï¼ŒURLå°†ä¼šè¢«æ›¿æ¢æˆ `/b` ï¼Œç„¶ååŒ¹é…è·¯ç”±ä¸º `/b` ã€‚
è€Œåˆ«åçš„è·¯ç”±åŒ¹é…åˆ™ä¿æŒä¸å˜ã€‚ä¾‹å¦‚ï¼Œ**`/a` çš„åˆ«åæ˜¯ `/b` ï¼Œæ„å‘³ç€ï¼Œå½“ç”¨æˆ·è®¿é—® `/b` æ—¶ï¼ŒURLä¼šä¿æŒä¸º `/b` ï¼Œä½†æ˜¯è·¯ç”±åŒ¹é…åˆ™ä¸º `/a` ï¼Œå°±åƒç”¨æˆ·è®¿é—® `/a` ä¸€æ ·**ã€‚

ä¸Šé¢å¯¹åº”çš„è·¯ç”±é…ç½®ä¸ºï¼š

~~~ javascript
const router = new VueRouter({
    routers: [
        {path: '/a', component: A, alias: '/b'}
    ]
})
~~~

å€ŸåŠ©â€œåˆ«åâ€ï¼Œä½ å¯ä»¥ä¸å¿…å—é™äºé…ç½®çš„åµŒå¥—è·¯ç”±ç»“æ„ï¼Œè€Œè‡ªç”±åœ°å°†UIç»“æ„æ˜ å°„åˆ°ä»»æ„çš„URLã€‚
æ›´å¤šé«˜çº§ç”¨æ³•ï¼Œè¯·[ç§»æ­¥ä¾‹å­](https://github.com/vuejs/vue-router/blob/dev/examples/route-alias/app.js)

### è·¯ç”±ç»„ä»¶ä¼ å‚

åœ¨ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ `$route` ä¼šä½¿è¯¥ç»„ä»¶ä¸å…¶å¯¹åº”çš„è·¯ç”±å½¢æˆé«˜åº¦è€¦åˆï¼Œä»è€Œä½¿ç»„ä»¶åªèƒ½åœ¨æŸäº›ç‰¹å®šçš„URLä¸Šä½¿ç”¨ï¼Œé™åˆ¶äº†ç»„ä»¶çš„çµæ´»ä½¿ç”¨ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ `props` å°†ç»„ä»¶å’Œè·¯ç”±è§£è€¦ï¼š

**ä¸ `$route` è€¦åˆ**

~~~ javascript
const User = {
    template: '<div>User {{$route.params.id}}</div>'
}
const router = new VueRouter({
    routers: [
        {path: '/user/:id', component: User}
    ]
})
~~~

**é€šè¿‡ `props` è§£è€¦**

~~~ javascript
const User = {
    props: ['id'],
    template: '<div>User {{id}}</div>'
}

const router = new VueRouter({
    routers: [
        {path: '/user/:id', component: User, props: true},

        // å¯¹äºåŒ…å«å‘½åè§†å›¾çš„è·¯ç”±ï¼Œä½ å¿…é¡»åˆ†åˆ«ä¸ºæ¯ä¸ªå‘½åè§†å›¾è®¾ç½® â€˜propsâ€™é€‰é¡¹ï¼š
        {
            path: '/user/:id',
            components: {default: User, sidebar: Sidebar},
            props: {default: true, sidebar: false}
        }
    ]
})
~~~

è¿™æ ·ä½ ä¾¿å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨è¯¥ç»„ä»¶ï¼Œä½¿å¾—è¯¥ç»„ä»¶æ›´æ˜“äºé‡ç”¨å’Œæµ‹è¯•ã€‚

#### å¸ƒå°”æ¨¡å¼

å¦‚æœ`props`è¢«è®¾ç½®ä¸º `true` ï¼Œ`route.params` å°†ä¼šè¢«è®¾ç½®ä¸ºç»„ä»¶å±æ€§ã€‚

#### å¯¹è±¡æ¨¡å¼

å¦‚æœ `props` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä¼šæŒ‰åŸæ ·è®¾ç½®ä¸ºç»„ä»¶å±æ€§ã€‚å½“ `props`æ˜¯é™æ€ï¼ˆå­—ç¬¦ä¸²ï¼‰çš„æ—¶å€™æœ‰ç”¨ã€‚

~~~ javascript
const router = new VueRouter({
    routers: [
        {path: '/promotion/from-newletter', component: Promotion, props: {newletterPopup: false}}
    ]
})
~~~

#### å‡½æ•°æ¨¡å¼

å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å› `props` ã€‚ä»è€Œä¾¿å¯ä»¥å°†å‚æ•°è½¬æ¢æˆå¦ä¸€ç§ç±»å‹ï¼Œæ¯”å¦‚å¯ä»¥å°†é‡‘æ³°å€¼ä¸åŸºäºè·¯ç”±çš„å‚æ•°ç»“åˆç­‰ç­‰ã€‚

~~~ javascript
const router = new VueRouter({
    router: [
        {
            path: '/search', component: SearchUser, props: (route) => ({query: route.query.q})
        }
    ]
})
~~~

URL `/search?q=vue` ä¼šå°† `{query: 'vue'}` ä½œä¸ºå±æ€§ä¼ é€’ç»™ `SearchUser` ç»„ä»¶ã€‚

> æ³¨æ„: è¯·å°½å¯èƒ½ä¿æŒ `props` å‡½æ•°ä¸º[**æ— çŠ¶æ€**][3]çš„ï¼Œå› ä¸ºå®ƒåªä¼šåœ¨è·¯ç”±å‘ç”Ÿå˜åŒ–æ—¶èµ·ä½œç”¨ã€‚å¦‚æœä½ éœ€è¦çŠ¶æ€æ¥å®šä¹‰ `props` ï¼Œè¯·ä½¿ç”¨**åŒ…è£…ç»„ä»¶**ï¼Œè¿™æ ·Vueæ‰å¯ä»¥å¯¹çŠ¶æ€å˜åŒ–ä½œå‡ºååº”ã€‚

è¯¦ç»†ç”¨æ³•ï¼Œè¯·æŸ¥çœ‹[ä¾‹å­](https://github.com/vuejs/vue-router/blob/dev/examples/route-props/app.js)æˆ–ä¸‹é¢ä»£ç 

~~~ javascript
import Vue from 'vue'
import VueRouter from 'vue-router'
import Hello from './Hello.vue'

Vue.use(VueRouter)

function dynamicPropsFn (route) {
  const now = new Date()
  return {
    name: (now.getFullYear() + parseInt(route.params.years)) + '!'
  }
}

const router = new VueRouter({
  mode: 'history',
  base: __dirname,
  routes: [
    { path: '/', component: Hello }, // No props, no nothing
    { path: '/hello/:name', component: Hello, props: true }, // Pass route.params to props
    { path: '/static', component: Hello, props: { name: 'world' }}, // static values
    { path: '/dynamic/:years', component: Hello, props: dynamicPropsFn }, // custom logic for mapping between route and props
    { path: '/attrs', component: Hello, props: { name: 'attrs' }}
  ]
})

new Vue({
  router,
  template: '
    <div id="app">
      <h1>Route props</h1>
      <ul>
        <li><router-link to="/">/</router-link></li>
        <li><router-link to="/hello/you">/hello/you</router-link></li>
        <li><router-link to="/static">/static</router-link></li>
        <li><router-link to="/dynamic/1">/dynamic/1</router-link></li>
        <li><router-link to="/attrs">/attrs</router-link></li>
      </ul>
      <router-view class="view" foo="123"></router-view>
    </div>
  '
}).$mount('#app')
~~~

### HTML Historyæ¨¡å¼

 å‚è€ƒ:</br>
[ä¸€](https://juejin.im/post/5a61908c6fb9a01c9064f20a)</br>
[äºŒ](https://juejin.im/post/5b31a4f76fb9a00e90018cee)</br>
[ä¸‰](https://www.jianshu.com/p/3fcae6a4968f)

#### ä¸ºä»€ä¹ˆè¦æœ‰hash å’Œ history

å¯¹äºVueè¿™ç±»æ¸è¿›å¼å‰ç«¯å¼€å¤§æ¡†æ¶ï¼Œä¸ºäº†æ„å»ºSPAï¼ˆå•é¡µé¢åº”ç”¨ï¼‰ï¼Œéœ€è¦å¼•å…¥**å‰ç«¯è·¯ç”±ç³»ç»Ÿ**ï¼Œè¿™ä¹Ÿæ˜¯Vue_routerå­˜åœ¨çš„æ„ä¹‰ã€‚å‰ç«¯è·¯ç”±çš„æ ¸å¿ƒï¼Œå°±åœ¨äº--**æ”¹å˜è§†å›¾çš„åŒæ—¶ä¸ä¼šå‘åç«¯å‘å‡ºè¯·æ±‚**ã€‚

ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œå½“å‰æµè§ˆå™¨æä¾›äº†ä¸€ä¸‹ä¸¤ç§æ”¯æŒï¼š

1. **`hash`**--å³åœ°å€æ URLä¸­çš„ `#` ç¬¦å·ï¼ˆæ­¤hashä¸æ˜¯å¯†ç å­¦é‡Œçš„æ•£åˆ—è¿ç®—)ã€‚</br>æ¯”å¦‚è¿™ä¸ªURL: `http://www.abc.com/#/hello` ï¼Œhashçš„å€¼ä¸º `#/hello` ã€‚å®ƒçš„ç‰¹ç‚¹åœ¨äºï¼šhashè™½ç„¶å‡ºç°åœ¨URLä¸­ï¼Œä½†ä¸ä¼šè¢«åŒ…æ‹¬åœ¨HTTPè¯·æ±‚ä¸­ï¼Œå¯¹åç«¯å®Œå…¨æ²¡æœ‰å½±å“ï¼Œå› æ­¤**æ”¹å˜hashä¸ä¼šé‡æ–°åŠ è½½é¡µé¢**ã€‚
2. **`history`**--åˆ©ç”¨äº†HTML5 History Interface ä¸­æ–°å¢çš„ `pushState()` å’Œ `replaceState()` æ–¹æ³•ï¼ˆéœ€ç‰¹å®šæµè§ˆå™¨æ”¯æŒï¼‰ã€‚</br>è¿™ä¸¤ä¸ªæ–¹æ³•åº”ç”¨äºæµè§ˆå™¨çš„å†å²è®°å½•æ ˆï¼Œåœ¨å½“å‰å·²æœ‰çš„ `back`ã€ `forward`ã€`go` çš„åŸºç¡€ä¹‹ä¸Šï¼Œå®ƒä»¬æä¾›äº†å¯¹å†å²è®°å½•è¿›è¡Œä¿®æ”¹çš„åŠŸèƒ½ã€‚åªæ˜¯å½“å®ƒä»¬æ‰§è¡Œä¿®æ”¹æ—¶ï¼Œè™½ç„¶å½“å‰URLè¢«æ”¹å˜äº†ï¼Œä½†æ˜¯æµè§ˆå™¨ä¸ä¼šç«‹å³å‘åç«¯å‘é€è¯·æ±‚ã€‚

å› æ­¤å¯ä»¥è¯´ï¼Œhashæ¨¡å¼å’Œhistoryæ¨¡å¼éƒ½å±äºæµè§ˆå™¨è‡ªèº«çš„å±æ€§ï¼ŒVue-Routeråªæ˜¯åˆ©ç”¨äº†è¿™ä¸¤ä¸ªç‰¹æ€§æ¥å®ç°å‰ç«¯è·¯ç”±ï¼ˆé€šè¿‡è°ƒç”¨æµè§ˆå™¨æä¾›çš„æ¥å£ï¼‰ã€‚

#### hashæ¨¡å¼

hashæ¨¡å¼èƒŒåçš„åŸç†æ˜¯ `onhashchange` äº‹ä»¶ï¼Œå¯ä»¥åœ¨windowå¯¹è±¡ä¸Šç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼š

~~~ javascript
window.onhashchange = function(event) {
    console.log(event.oldURL, event.newURL);
    let hash = location.hash.slice(1);
    document.body.style.color = hash;
}
~~~

ä¸Šé¢çš„diamanteå¯ä»¥å®ç°é€šè¿‡æ”¹å˜hashæ¥æ”¹å˜é¡µé¢å­—ä½“é¢œè‰²çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè¯´æ˜hashçš„åŸç†ã€‚

æ›´å…³é”®çš„ä¸€ç‚¹æ˜¯ï¼Œå› ä¸ºhashå‘ç”Ÿå˜åŒ–çš„URLéƒ½ä¼šè¢«æµè§ˆå™¨è®°å½•ä¸‹æ¥ï¼Œä»è€Œæµè§ˆå™¨çš„å‰è¿›åé€€éƒ½å¯ä»¥ä½¿ç”¨äº†ã€‚åŒæ—¶ç‚¹å‡»åé€€æ—¶ï¼Œé¡µé¢å­—ä½“é¢œè‰²ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°½ç®¡æµè§ˆå™¨æ²¡æœ‰è¯·æ±‚æœåŠ¡å™¨ï¼Œé¡µé¢é¢œè‰²ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯é¡µé¢çŠ¶æ€å’ŒURLä¸€ä¸€å…³è”èµ·æ¥äº†ã€‚

#### historyæ¨¡å¼åº”ç”¨åœºæ™¯

ä¸€èˆ¬åœºæ™¯ä¸‹ï¼Œhash å’Œ history éƒ½å¯ä»¥ï¼Œé™¤éä½ æ›´åœ¨æ„é¢œå€¼ï¼Œ`#` ç¬¦å·å¤¹æ‚åœ¨URLé‡Œçœ‹èµ·æ¥ç¡®å®ä¸å¤ªç¾è§‚ã€‚

å¦å¤–ï¼Œæ ¹æ® [Mozilla Develop Network][4]çš„ä»‹ç»ï¼Œè°ƒç”¨ `history.pushState()` ç›¸æ¯”äºç›´æ¥ä¿®æ”¹ `hash` ï¼Œå­˜åœ¨ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- `pushState()` è®¾ç½®çš„æ–°URLå¯ä»¥ä½¿ä¸å½“å‰URL**åŒæº**çš„ä»»æ„URLï¼›è€Œ `hash` åªå¯ä¿®æ”¹ `#` åé¢çš„éƒ¨åˆ†ï¼Œå› æ­¤åªèƒ½è®¾ç½®ä¸å½“å‰URL**åŒæ–‡æ¡£**çš„URLï¼›
- `pushState()` è®¾ç½®æ–°çš„URLå¯ä»¥ä¸å½“å‰URLä¸€æ¨¡ä¸€æ ·ï¼Œè¿™æ ·ä¹Ÿä¼šæŠŠè®°å½•æ·»åŠ åˆ°æ ˆä¸­ï¼›è€Œ `hash` è®¾ç½®çš„æ–°å€¼å¿…é¡»ä¸åŸæ¥ä¸ä¸€æ ·æ‰ä¼šè§¦å‘åŠ¨ä½œå°†è®°å½•æ·»åŠ åˆ°æ ˆä¸­ï¼›
- `pushState()` é€šè¿‡ `stateObject` å‚æ•°å¯ä»¥æ·»åŠ ä»»æ„ç±»å‹çš„æ•°æ®åˆ°è®°å½•ä¸­ï¼›è€Œ `hash` åªå¯æ·»åŠ ç«¯å­—ç¬¦ä¸²ï¼›
- `pushState()` å¯é¢å¤–è®¾ç½® `title`å±æ€§ä¾›åç»­ä½¿ç”¨ã€‚

å½“ç„¶ï¼Œ`history` æ¨¡å¼ä¹Ÿä¸æ˜¯æ²¡æœ‰ç¼ºé™·ã€‚SPAè™½ç„¶åœ¨æµè§ˆå™¨ä¸­æ¸¸åˆƒæœ‰ä½™ï¼Œä½†æ˜¯å½“çœŸè¦é€šè¿‡URLå‘åç«¯å‘èµ·HTTPè¯·æ±‚æ—¶ï¼Œä¸¤è€…çš„å·®å¼‚å°±è¡¨ç°å‡ºæ¥äº†ã€‚å°¤å…¶åœ¨ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥URLåå›è½¦ï¼Œæˆ–è€…åˆ·æ–°ï¼ˆé‡å¯ï¼‰æµè§ˆå™¨çš„æ—¶å€™ã€‚

1. `hash` æ¨¡å¼ä¸‹ï¼Œä»… `hash` ç¬¦å·ä¹‹å‰çš„å†…å®¹ä¼šè¢«åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œå¦‚ `http://www.abc.com` ï¼Œå› æ­¤å¯¹äºåç«¯æ¥è¯´ï¼Œå³ä½¿æ²¡æœ‰åšåˆ°å¯¹è·¯ç”±çš„å…¨è¦†ç›–ï¼Œä¹Ÿä¸ä¼šè¿”å›404é”™è¯¯ã€‚
2. `history` æ¨¡å¼ä¸‹ï¼Œå‰ç«¯çš„URLå¿…é¡»å’Œå®é™…å‘åç«¯å‘èµ·è¯·æ±‚çš„URLä¸€è‡´ï¼Œå¦‚ `http://www.abc.com/book/id`ã€‚å¦‚æœåç«¯ç¼ºå°‘å¯¹ `/book/id` çš„è·¯ç”±å¤„ç†ï¼Œå°†è¿”å›404é”™è¯¯ã€‚

å› æ­¤ï¼ŒVue-Routerå®˜ç½‘é‡Œå¦‚æ­¤æè¿°ï¼šâ€œ**ä¸è¿‡è¿™ç§æ¨¡å¼è¦ç©å¥½ï¼Œè¿˜éœ€è¦åå°é…ç½®æ”¯æŒ**......æ‰€ä»¥ä½ è¦åœ¨æœåŠ¡ç«¯å¢åŠ ä¸€ä¸ªè¦†ç›–æ‰€æœ‰æƒ…å†µçš„å€™é€‰èµ„æºï¼šå¦‚æœURLåŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œåˆ™åº”è¯¥è¿”å›åŒä¸€ä¸ªindex.htmlé¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯ä½ APPä¾èµ–çš„é¡µé¢ã€‚â€

#### åç«¯é…ç½®ä¾‹å­

// ä¸‹é¢æ˜¯ä¸€äº›é’ˆå¯¹æœªåŒ¹é…åˆ°é™æ€èµ„æºåï¼Œè¿”å›index.htmlé¡µé¢çš„è®¾ç½®ã€‚

$nginx$

$åŸç”ŸNode.js$

$åŸºäºNode.jsçš„Express$

$InternetInformation Servicesï¼ˆIISï¼‰$

$Caddy$

$Firebaseä¸»æœº$

#### è­¦å‘Šâš ï¸

ç»™ä¸ªè­¦å‘Šï¼Œå› ä¸ºè¿™ä¹ˆåšä»¥åï¼ŒæœåŠ¡å™¨å°±ä¸å†è¿”å› 404 é”™è¯¯é¡µé¢ï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰è·¯å¾„éƒ½ä¼šè¿”å› index.html æ–‡ä»¶ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä½ åº”è¯¥åœ¨ Vue åº”ç”¨é‡Œé¢è¦†ç›–æ‰€æœ‰çš„è·¯ç”±æƒ…å†µï¼Œç„¶ååœ¨ç»™å‡ºä¸€ä¸ª 404 é¡µé¢ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

~~~ javascript
const router = new VueRouter({
    mode: 'history',
    routers: [
        {path: '*', component: NotFoundComponent}
    ]
})
~~~

æˆ–è€…ï¼Œå¦‚æœä½ ä½¿ç”¨ Node.js æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ç”¨æœåŠ¡ç«¯è·¯ç”±åŒ¹é…åˆ°æ¥çš„ URLï¼Œå¹¶åœ¨æ²¡æœ‰åŒ¹é…åˆ°è·¯ç”±çš„æ—¶å€™è¿”å› 404ï¼Œä»¥å®ç°å›é€€ã€‚æ›´å¤šè¯¦æƒ…è¯·æŸ¥é˜… [Vue æœåŠ¡ç«¯æ¸²æŸ“æ–‡æ¡£][5]ã€‚

## è¿›é˜¶

---

### å¯¼èˆªå®ˆå«

> å¯¼èˆªè¡¨ç¤ºè·¯ç”±æ­£åœ¨å‘ç”Ÿæ”¹å˜ã€‚

æ­£å¦‚å…¶åï¼Œ `vue-router` æä¾›çš„å¯¼èˆªå®ˆå«ä¸»è¦é€šè¿‡è·³è½¬æˆ–å–æ¶ˆçš„æ–¹å¼ç”¨æ¥å®ˆå«å¯¼èˆªã€‚å¹¶ä¸”æœ‰å¤šç§æ–¹å¼æ¤å…¥å¯¼èˆªè¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚å…¨å±€çš„ã€å•è·¯ç”±ç‹¬äº«çš„ã€æˆ–è€…ç»„ä»¶çº§çš„ã€‚

æ³¨æ„ï¼Œå‚æ•°æˆ–æŸ¥è¯¢çš„æ”¹å˜å¹¶ä¸ä¼šè¿›å…¥æˆ–ç¦»å¼€å¯¼èˆªå®ˆå«ã€‚ä½ å¯ä»¥é€šè¿‡è§‚å¯Ÿ `$route` å¯¹è±¡æ¥åº”å¯¹è¿™äº›å˜åŒ–ï¼Œæˆ–è€…ä½¿ç”¨ `beforeRouteUpdate` ç»„ä»¶å†…å®ˆå«ã€‚

#### å…¨å±€å‰ç½®å®ˆå«

å¯ä»¥ä½¿ç”¨ `router.beforeEach` æ³¨å†Œå…¨å±€å‰ç½®å®ˆå«ï¼š

~~~ javascript
const router = new VueRouter({...})

router.beforeEach((to, from, next) => {
    // ...
})
~~~

å½“ä¸€ä¸ªå¯¼èˆªè¢«è§¦å‘æ—¶ï¼Œå…¨å±€å‰ç½®å®ˆå«æŒ‰ç…§å…¶åˆ›å»ºé¡ºåºè¢«ä¾æ¬¡è°ƒç”¨ã€‚å¯¼èˆªæ˜¯å¼‚æ­¥è§£ææ‰§è¡Œçš„ï¼Œå¹¶ä¸”å¯¼èˆªåœ¨æ‰€æœ‰å®ˆå«(hooks)è¢«è§£æ(resolve)å®Œæˆå‰ä¸€ç›´å¤„äºç­‰å¾…ä¸­ã€‚

æ¯ä¸ªå®ˆå«å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š

- **`to: Route`** : å°†è¢«å¯¼èˆªè‡³çš„ç›®æ ‡è·¯ç”±å¯¹è±¡ã€‚
- **`from: Route`** : å½“å‰è·¯ç”±å¯¹è±¡ï¼Œå°†è¦å› å¯¼èˆªè€Œç¦»å¼€è¯¥è·¯ç”±ã€‚
- **`next: Function`** : å¿…é¡»è¦è°ƒç”¨è¯¥å‡½æ•°æ¥è§£æè¿™ä¸ªé’©å­(hook)ï¼Œå…¶æ‰§è¡Œæ•ˆæœä¾èµ–äºæä¾›ç»™è¯¥ `next` å‡½æ•°çš„å‚æ•°ï¼š
  - **`next()`** : è¿›è¡Œä¼ è¾“çº¿è·¯(pipeline)ä¸­çš„ä¸‹ä¸€ä¸ªé’©å­(hook)ï¼Œå¦‚æœæ‰€æœ‰é’©å­éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™å¯¼èˆªçš„çŠ¶æ€å°±æ˜¯ç¡®è®¤çš„(confirmed)ï¼›
  - **`next(false)`** : ä¸­æ–­å½“å‰å¯¼èˆªã€‚å¦‚æœæµè§ˆå™¨URLè¢«æ”¹å˜äº†(å¯èƒ½æ˜¯ç”¨æˆ·æ‰‹åŠ¨æ“ä½œæˆ–ç‚¹å‡»å›é€€æŒ‰é’®)ï¼Œé‚£ä¹ˆå¯¼èˆªç›®æ ‡(URLåœ°å€)é‡ç½®ä¸º `from` è·¯ç”±å¯¹åº”çš„åœ°å€;
  - **`next('/')` æˆ– `next({path: '/'})`** : é‡å®šå‘åˆ°ä¸€ä¸ªä¸åŒçš„ä½ç½®ã€‚å½“å‰å¯¼èˆªå°†è¢«ä¸­æ–­ï¼Œç„¶åå¼€å§‹ä¸€ä¸ªæ–°çš„å¯¼èˆªï¼Œä½ å¯ä»¥å‘ next å‡½æ•°ä¼ é€’ä»»æ„ä½ç½®å¯¹è±¡ï¼Œ</br>ä¸”å…è®¸è®¾ç½®è¯¸å¦‚ï¼š`replace: true`ï¼Œ`name: 'home'`ä¹‹ç±»çš„é€‰é¡¹ï¼Œä»¥åŠä»»æ„åœ¨ `router-link` ç»„ä»¶çš„ `to` å±æ€§åŠ `router.push` æ–¹æ³•ä¸­ä½¿ç”¨çš„é€‰é¡¹ï¼›
  - **`next(error)`** : (2.4.0+)å¦‚æœä¼ å…¥ `next` å‡½æ•°çš„å‚æ•°æ˜¯ `Error` çš„å®ä¾‹ï¼Œå¯¼èˆªå°†è¢«ä¸­æ­¢ä¸”é”™è¯¯ä¼šä¼ é€’ç»™ç»ç”± `router.onError()` æ–¹æ³•æ³¨å†Œçš„å›è°ƒå‡½æ•°(callbacks)ã€‚

**è¦ç¡®ä¿è°ƒç”¨ `next` å‡½æ•°ï¼Œå¦åˆ™å®ˆå«(hook)å°†ä¸ä¼šè¢«è§£æï¼Œå¯æŸ¥çœ‹[è·¯ç”±å…ƒä¿¡æ¯](#è·¯ç”±å…ƒä¿¡æ¯)ä¸­çš„ç¤ºä¾‹**ã€‚

#### å…¨å±€è§£æå®ˆå«

> 2.5.0æ–°å¢

ä½ å¯ä»¥ç”¨ `router.beforeResolve` æ³¨å†Œä¸€ä¸ªå…¨å±€å®ˆå«ã€‚è¿™å’Œ `router.beforeEach` ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯åœ¨å¯¼èˆªè¢«ç¡®è®¤ä¹‹å‰ï¼Œ**åŒæ—¶åœ¨æ‰€æœ‰ç»„ä»¶å†…å®ˆå«å’Œå¼‚æ­¥è·¯ç”±ç»„ä»¶è¢«è§£æä¹‹å**ï¼Œè§£æå®ˆå«å°±è¢«è°ƒç”¨ã€‚

#### å…¨å±€åç½®é’©å­

ä½ ä¹Ÿå¯ä»¥æ³¨å†Œå…¨å±€åç½®é’©å­ï¼Œç„¶è€Œå’Œå®ˆå«ä¸åŒçš„æ˜¯ï¼Œè¿™äº›é’©å­ä¸ä¼šæ¥å— next å‡½æ•°ï¼Œä¹Ÿä¸ä¼šæ”¹å˜å¯¼èˆªæœ¬èº«ï¼š

~~~ javascript
router.afterEach((to, from) => {
    // ...
})
~~~

#### è·¯ç”±ç‹¬äº«å®ˆå«

ä½ å¯ä»¥ç›´æ¥åœ¨è·¯ç”±çš„é…ç½®å¯¹è±¡ä¸­å®šä¹‰ `beforeEnter` å®ˆå«ï¼š

~~~ javascript
const router = new VueRouter({
    routers: [
        {
            path: './foo',
            component: Foo,
            beforeEnter: (to, from, next) => {
                // ...
            }
        }
    ]
})
~~~

è¿™äº›å®ˆå«å’Œå…¨å±€å‰ç½®å®ˆå«æ‹¥æœ‰ä¸€æ ·çš„æ–¹æ³•ç­¾å(signature)ï¼Œå³æ–¹æ³•å‚æ•°ã€‚

#### ç»„ä»¶å†…å®ˆå«

ä½ è¿˜å¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨ç›´æ¥å®šä¹‰ä¸€ä¸‹è·¯ç”±å¯¼èˆªå®ˆå«ï¼š

- beforeRouterEnter
- beforeRouterUpdate (2.2æ–°å¢)
- beforeRouterLeave

~~~ javascript
const Foo = {
    template: '...',
    beforRouterEnter (to, from, next) {
        // åœ¨æ¸²æŸ“è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±è¢« confirm å‰è°ƒç”¨
        // ä¸èƒ½ è·å–ç»„ä»¶å®ä¾‹ 'this'
        // å› ä¸ºå½“å®ˆå«æ‰§è¡Œå‰ï¼Œç»„ä»¶å®ä¾‹è¿˜æœªè¢«åˆ›å»º
    },
    beforeRouterUpdate (to, from, next) {
        // åœ¨å½“å‰è·¯ç”±è¢«æ”¹å˜ï¼Œä½†è¯¥ç»„ä»¶è¢«å¤ç”¨æ—¶è¢«è°ƒç”¨
        // ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªå¸¦æœ‰åŠ¨æ€å‚æ•°çš„è·¯å¾„ï¼š/foo/:idï¼Œåœ¨/foo/1 å’Œ /foo/2 ä¹‹é—´è·³è½¬çš„æ—¶å€™
        // ç”±äºä¼šæ¸²æŸ“åŒæ ·çš„ Foo ç»„ä»¶ï¼Œå› æ­¤ç»„ä»¶å®ä¾‹ä¼šè¢«å¤ç”¨
        // å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ â€˜thisâ€™
    },
    beforeRouterLeave (to, from, next) {
        // å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨
        // å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ 'this'
    }
}
~~~

`beforeRouterEnter` å®ˆå«**ä¸èƒ½**è®¿é—® `this`ï¼Œå› ä¸ºå®ˆå«åœ¨å¯¼èˆªç¡®è®¤å‰è¢«è°ƒç”¨ï¼Œå› æ­¤å³å°†ç™»åœºçš„æ–°ç»„å»ºè¿˜æœªè¢«åˆ›å»ºã€‚

ä¸è¿‡ï¼Œä½ å¯ä»¥é€šè¿‡ä¼ ä¸€ä¸ªå›è°ƒæ–¹æ³•ç»™ next æ¥è®¿é—®ç»„ä»¶å®ä¾‹ï¼Œåœ¨å¯¼èˆªè¢«ç¡®è®¤çš„æ—¶å€™æ‰§è¡Œå›è°ƒï¼Œä¸”ç»„ä»¶å®ä¾‹ä¼šä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å›è°ƒæ–¹æ³•ï¼š

~~~ javascript
beforeRouterEnter (to, from, next) {
    next(vm => {
        // é€šè¿‡ â€˜vmâ€™ è®¿é—®ç»„ä»¶å®ä¾‹
    })
}
~~~

> æ³¨æ„ï¼š `beforeRouterEnter` æ˜¯æ”¯æŒç»™ next ä¼ é€’å›è°ƒçš„ä½ç§»å®ˆå«ã€‚å¯¹äº `beforeRouterUpdate` å’Œ `beforeRouterLeave` æ¥è¯´ï¼Œ`this` å·²ç»å¯ç”¨äº†ï¼Œæ‰€ä»¥ä¸æ”¯æŒä¼ é€’å›è°ƒï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦äº†ã€‚

~~~ javascript
beforeRouterUpdate (to, from, next) {
    // just use â€˜thisâ€™
    this.name = to.params.name,
    next()
}
~~~

è¿™ä¸ªç¦»å¼€å®ˆå«é€šå¸¸ç”¨æ¥ç¦æ­¢ç”¨æˆ·åœ¨è¿˜æœªä¿å­˜ä¿®æ”¹å‰çªç„¶ç¦»å¼€å½“å‰é¡µé¢(URLåœ°å€)ã€‚è¯¥å¯¼èˆªå¯ä»¥é€šè¿‡ `next(false)` æ¥å–æ¶ˆã€‚

~~~ javascript
beforeRouterleave (to, from, next) {
    const answer = window.confirm('Do you really want to leave? you have unsaved changges!')
    if (answer) {
        next()
    } else {
        next(false)
    }
}
~~~

#### å®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹

ğŸ¦‹ğŸğŸ¸

1. å¯¼èˆªè¢«è§¦å‘ã€‚
2. åœ¨å¤±æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouterLeave` å®ˆå«ã€‚
3. è°ƒç”¨å…¨å±€çš„ `beforeEach` å®ˆå«ã€‚
4. åœ¨é‡ç”¨çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouterUpdate` å®ˆå«(2.2+)
5. åœ¨è·¯ç”±é…ç½®é‡Œè°ƒç”¨ `beforeEnter` å®ˆå«ã€‚
6. è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶ã€‚
7. åœ¨è¢«æ¿€æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ `beforeRouterEnter`ã€‚
8. è°ƒç”¨å…¨å±€çš„ `beforeResolve` å®ˆå«(2.5+)ã€‚
9. å¯¼èˆªè¢«ç¡®è®¤(confirmed)ã€‚
10. è°ƒç”¨å…¨å±€çš„ `afterEach` é’©å­ã€‚
11. è§¦å‘ DOM æ›´æ–°ã€‚
12. ç”¨åˆ›å»ºå¥½çš„å®ä¾‹è°ƒç”¨ `beforeRouterEnter` å®ˆå«ä¸­ä¼ ç»™ next çš„å›è°ƒå‡½æ•°ã€‚

### è·¯ç”±å…ƒä¿¡æ¯

ğŸ¦‹ æ³¨æ„ä¸å¯¼èˆªå®ˆå«çš„è”ç³»ã€‚

vue-routerè·¯ç”±å…ƒä¿¡æ¯ç®€å•è¯´ï¼Œå°±æ˜¯é€šè¿‡metaå¯¹è±¡ä¸­çš„ä¸€äº›å±æ€§è®¾å®šæ¥åˆ¤æ–­å½“å‰è·¯ç”±æ˜¯å¦éœ€è¦è¿›è¡Œç›¸å…³å¤„ç†ã€‚

åœ¨è·¯ç”±åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªè·¯ç”±è®°å½•é…ç½®ä¸€ä¸ªæ•°æ®å­—æ®µï¼Œä¸€èˆ¬å«åš `meta`ï¼Œæˆ‘ä¹ˆå¯ä»¥è®¾ç½®ä¸€äº›è‡ªå®šä¹‰ä¿¡æ¯ï¼Œä¾›é¡µé¢ç»„ä»¶æˆ–è€…è·¯ç”±é’©å­å‡½æ•°ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨æµè§ˆä¸€äº›ç½‘ç«™çš„æ—¶å€™ï¼Œæœ‰æ—¶ä¼šéªŒè¯ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½éœ€è¦éªŒè¯çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åœ¨è·¯ç”±è®°å½•ä¸­æ·»åŠ è·¯ç”±å…ƒæ•°æ®æ¥è¿›è¡ŒåŒºåˆ†ã€‚

å®šä¹‰è·¯ç”±çš„æ—¶å€™å¯ä»¥é…ç½® `meta` å­—æ®µï¼š

~~~ javascript
const router = new VueRouter({
    routers: [
        {
            path: '/foo',
            component: Foo,
            children: [
                {
                    path: '/bar',
                    component: Bar,
                    // a meta filed
                    meta: {requiresAuth: true}
                }
            ]
        }
    ]
})
~~~

é‚£ä¹ˆå¦‚ä½•è®¿é—®è¿™ä¸ª `meta` å­—æ®µå‘¢ï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬ç§°å‘¼ `router` é…ç½®ä¸­çš„æ¯ä¸ªè·¯ç”±å¯¹è±¡ä¸º**è·¯ç”±è®°å½•**ã€‚è·¯ç”±è®°å½•æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œå› æ­¤ï¼Œå½“ä¸€ä¸ªè·¯ç”±åŒ¹é…æˆåŠŸåï¼Œå®ƒå¯èƒ½åŒ¹é…å¤šä¸ªè·¯ç”±è®°å½•ã€‚

ä¾‹å¦‚ï¼Œæ›´å…·ä¸Šé¢çš„è·¯ç”±é…ç½®ï¼Œ`/foo/bar` è¿™ä¸ªURLå°†ä¼šåŒ¹é…çˆ¶è·¯ç”±è®°å½•å’Œå­è·¯ç”±è®°å½•ã€‚

ä¸€ä¸ªè·¯ç”±åŒ¹é…åˆ°çš„æ‰€æœ‰è·¯ç”±è®°å½•éƒ½ä¼šæš´éœ²ä¸ºç”± `$route` å¯¹è±¡ï¼ˆè¿˜æœ‰åœ¨å¯¼èˆªå®ˆå«ä¸­çš„è·¯ç”±å¯¹è±¡ï¼‰ç»„æˆçš„ `$route.matched` æ•°ç»„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦éå†è¯¥æ•°ç»„æ¥æ£€æŸ¥è·¯ç”±è®°å½•ä¸­çš„ `meta` å­—æ®µï¼Œåœ¨é‡Œäº†æˆ‘ä»¬ä½¿ç”¨ `some()` å‡½æ•°æ¥éå†æ•°ç»„ï¼Œå¹¶ç”¨åˆ°äº†å¯¼èˆªå®ˆå«çš„å…¨å±€å®ˆå«ä¸­çš„`beforeEach` æ–¹æ³•ã€‚

~~~ javascript
// åœ¨è·¯ç”±æ›´æ–°ä¹‹å‰å»éå†è·¯ç”±è®°å½•çš„metaå…ƒä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨requiresAuthå±æ€§
router.beforeEach((to, from, next) => {
    if (to.matched.some(record => record.meta.requiresAuth)) {
        // å¦‚æœå­˜åœ¨ requiresAuth å±æ€§ï¼Œåˆ™æ®éœ€åˆ¤æ–­æ˜¯å¦ logged inï¼Œ
        // å¦‚æœä¸ºå¦ï¼Œåˆ™é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œ/login?redirect=to.fillPath
        if (!auth.loggedIn()) {
            next({
                path: '/login',
                query: {redirect: to.fullPath}
            })
        } else {
            next()
        }
    } else {
        // ç¡®ä¿ä¸€å®šè¦åœ¨æ­¤å¤„è°ƒç”¨ next()æ–¹æ³•
        next()
    }
})
~~~

$è§£æï¼š$

- metaå­—æ®µå°±æ˜¯è·¯ç”±å…ƒä¿¡æ¯å­—æ®µï¼ŒrequiresAuthæ˜¯ä»»æ„å–çš„å­—æ®µåç§°ï¼Œç”¨æ¥æ ‡è®°è¿™ä¸ªè·¯ç”±ä¿¡æ¯æ˜¯å¦éœ€è¦æ£€æµ‹ï¼Œtrue è¡¨ç¤ºéœ€è¦æ£€æµ‹ï¼›
- `if (to.matched.some(record => record.meta.requiresAuth))`ï¼Œä½¿ç”¨äº†ES6çš„ç®­å¤´å‡½æ•°è¯­æ³•ï¼Œ`to.matched`å³ä¸º$routeå¯¹è±¡æ•°ç»„ï¼Œå•ä¸ªè·¯ç”±å¯¹è±¡æˆ‘ä»¬å®šä¹‰ä¸º `record` ï¼Œå¹¶æ£€æµ‹è¿™ä¸ªè·¯ç”±å¯¹è±¡ï¼ˆè®°å½•ï¼‰æ˜¯å¦æ‹¥æœ‰ `meta` é€‰é¡¹ï¼Œå¦‚æœæœ‰ï¼Œå†æ£€æµ‹è¯¥é€‰é¡¹æ˜¯å¦æ‹¥æœ‰ `requiresAuth`è¿™ä¸ªå±æ€§ï¼Œå¹¶ä¸”æ˜¯å¦ä¸º `true`ï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œå°±ç¡®å®šäº†è¯¥ `/foo/bar` è·¯ç”±ï¼›
  - function (i) {return i + 1;} // ES5
  - (i) => i + 1 // ES6
- `if (!auth.loggedIn())`ï¼Œé€šè¿‡è‡ªå·±å°è£…çš„æ£€éªŒæ–¹æ³• `auth.loggedIn()`ï¼Œæ£€éªŒç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œä»è€Œå†³å®šæ¸²æŸ“ä¸‹ä¸€æ­¥æ“ä½œï¼›
- Array some()æ–¹æ³•
  - some() æ–¹æ³•ç”¨äºæ£€æµ‹æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¦æ»¡è¶³æŒ‡å®šæ¡ä»¶ï¼ˆå‡½æ•°æä¾›ï¼‰ï¼›
  - some() æ–¹æ³•ä¼šä¾æ¬¡æ‰§è¡Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå…ƒç´ æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¡¨è¾¾å¼è¿”å›trueï¼Œå‰©ä½™çš„å…ƒç´ ä¸ä¼šå†æ‰§è¡Œæ£€æµ‹ï¼Œå¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œåˆ™è¿”å›falseï¼›
  - some() ä¸ä¼šå¯¹ç©ºæ•°ç»„è¿›è¡Œæ£€æµ‹ï¼Œä¸”ä¸ä¼šæ”¹å˜åŸå§‹æ•°ç»„ï¼›
  - è¯­æ³•ï¼šarray.some(function(currentValue,index,arr),thisValue)
  - å‚æ•°è¯´æ˜ï¼š
    - currentValueï¼šå¿…é€‰ï¼Œå½“å‰å…ƒç´ çš„å€¼ï¼›
    - indexï¼šå¯é€‰ï¼Œå½“å‰å…ƒç´ çš„ç´¢å¼•å€¼ï¼›
    - arrï¼šå¯é€‰ï¼Œå½“å‰å…ƒç´ å±äºçš„æ•°ç»„å¯¹è±¡ï¼›
    - thisValueï¼šå¯é€‰ã€‚å¯¹è±¡ä½œä¸ºè¯¥æ‰§è¡Œå›è°ƒæ—¶ä½¿ç”¨ï¼Œä¼ é€’ç»™å‡½æ•°ï¼Œç”¨ä½œ "this" çš„å€¼ã€‚å¦‚æœçœç•¥äº† thisValue ï¼Œ"this" çš„å€¼ä¸º "undefined"ã€‚
  - è¿”å›å€¼ï¼šå¸ƒå°”å€¼ã€‚å¦‚æœæ•°ç»„ä¸­æœ‰å…ƒç´ æ»¡è¶³æ¡ä»¶è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚

#### åº”ç”¨åœºæ™¯

- åœ¨é¡µé¢è·³è½¬ä¹‹å‰ï¼ˆä½¿ç”¨åˆ°beforEach()æ–¹æ³•ï¼‰æ”¹å˜é¡µé¢æ ‡é¢˜ï¼ˆtitleï¼‰æˆ–è€…æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆä¸€èˆ¬åœ¨ç”¨æˆ·æ³¨å†Œã€å®Œå–„ç”¨æˆ·ä¿¡æ¯åŠé‡ç½®å¯†ç ç­‰æ´»åŠ¨åå‘ç›¸å…³é¡µé¢è·³è½¬æ—¶ï¼Œéœ€è¦æ£€æµ‹ï¼‰ï¼Œè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹[è¿™é‡Œ][6]å’Œ[è¿™é‡Œ][7]ï¼›
- åœ¨é¡µé¢è·³è½¬ä¹‹åç”¨äºå®ç°è¿”å›åˆ°é¡µé¢ä¹‹å‰æµè§ˆè¿‡çš„åŒºåŸŸæˆ–è€…è®©é¡µé¢è¿”å›åˆ°é¡¶éƒ¨åŠŸèƒ½ï¼ˆéœ€è¦å€ŸåŠ©afterEach()æ–¹æ³•ï¼‰ï¼Œä»£ç è§[è¿™é‡Œ][8]ã€‚

### è¿‡åº¦åŠ¨æ•ˆ

`<router-view>` æ˜¯åŸºæœ¬çš„åŠ¨æ€ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ `<transition>` ç»„ä»¶ç»™å®ƒæ·»åŠ ä¸€äº›è¿‡æ¸¡æ•ˆæœï¼š

~~~ javascript
<transition>
   <router-view></router-view>
</transition>
~~~

[Transition çš„æ‰€æœ‰åŠŸèƒ½][13] åœ¨è¿™é‡ŒåŒæ ·é€‚ç”¨ã€‚

#### å•ä¸ªè·¯ç”±çš„è¿‡åº¦

#### åŸºäºè·¯ç”±çš„åŠ¨æ€è¿‡åº¦

### æ•°æ®è·å–

æœ‰æ—¶å€™ï¼Œè¿›å…¥æŸä¸ªè·¯ç”±åï¼Œéœ€è¦ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨æ¸²æŸ“ç”¨æˆ·æ•°æ®æ—¶ï¼Œä½ éœ€è¦ä»æœåŠ¡å™¨è·å–ç”¨æˆ·æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥å®ç°ï¼š

- **å¯¼èˆªå®Œæˆä¹‹åè·å–**ï¼šå…ˆå®Œæˆå¯¼èˆªï¼Œç„¶ååœ¨æ¥ä¸‹æ¥çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­è·å–æ•°æ®ï¼Œåœ¨æ•°æ®è·å–æœŸé—´æ˜¾ç¤ºâ€œåŠ è½½ä¸­â€ä¹‹ç±»çš„æç¤ºã€‚
- **å½“è¡Œå®Œæˆä¹‹å‰è·å–**ï¼šå¯¼èˆªå®Œæˆå‰ï¼Œåœ¨è·¯ç”±è¿›å…¥(to)çš„å®ˆå«ä¸­è·å–æ•°æ®ï¼Œåœ¨æ•°æ®è·å–æˆåŠŸåæ‰§è¡Œå¯¼èˆªã€‚

ä»æŠ€æœ¯è§’åº¦å°†ï¼Œä¸¤ç§æ–¹å¼éƒ½ä¸é”™â€”â€”å°±çœ‹ä½ æƒ³è¦çš„ç”¨æˆ·ä½“éªŒæ˜¯å“ªç§ã€‚

#### å¯¼èˆªå®Œæˆåè·å–æ•°æ®

#### å¯¼èˆªå®Œæˆå‰è·å–æ•°æ®

### æ»šåŠ¨è¡Œä¸º

ä½¿ç”¨å‰ç«¯è·¯ç”±ï¼Œå½“åˆ‡æ¢åˆ°æ–°è·¯ç”±æ—¶ï¼Œæƒ³è¦é¡µé¢æ»šåˆ°é¡¶éƒ¨æˆ–è€…æ˜¯å°±åƒé‡æ–°åŠ è½½é¡µé¢é‚£æ ·ä¿æŒåŸå…ˆçš„æ»šåŠ¨ä½ç½®ã€‚vue-routerèƒ½åšåˆ°ï¼Œè€Œä¸”æ›´å¥½ï¼Œå®ƒè®©ä½ å¯ä»¥è‡ªå®šä¹‰è·¯ç”±åˆ‡æ¢æ—¶é¡µé¢å¦‚ä½•æ»šåŠ¨ã€‚

**æ³¨æ„ï¼šè¿™ä¸ªåŠŸèƒ½åªåœ¨æ”¯æŒ `history.pushState` çš„æµè§ˆå™¨ä¸­å¯ç”¨ã€‚**

å½“åˆ›å»ºä¸€ä¸ªRouterå®ä¾‹ï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ª `scrollBehavior` æ–¹æ³•ï¼š

~~~ javascript
const router = new VueRouter({
    router: [...],
    scrollBehavior (to, from, savedPosition) {
        // return æœŸæœ›æ»šåŠ¨åˆ°é‚£ä¸ªä½ç½®
    }
})
~~~

`scrollBehavior` æ–¹æ³•æ¥æ”¶ `to` å’Œ `from` è·¯ç”±å¯¹è±¡ã€‚ç¬¬ä¸‰ä¸ªå‚æ•° `savedPosition` å½“ä¸”ä»…å½“ `popstate` å¯¼èˆªï¼ˆé€šè¿‡æµè§ˆå™¨çš„**å‰è¿›/åé€€**æŒ‰é’®è§¦å‘ï¼‰æ—¶æ‰å¯ç”¨ã€‚
è¿™ä¸ªæ–¹æ³•è¿”å›æ»šåŠ¨ä½ç½®çš„å¯¹è±¡ä¿¡æ¯ï¼Œå¦‚ï¼š

- `{x: number, y: number}`
- `{selector: string, offset? : {x: number, y: number}}`(offsetåªåœ¨2.6.0+æ”¯æŒ)

å¦‚æœè¿”å›ä¸€ä¸ªfalsyçš„å€¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œé‚£ä¹ˆä¸ä¼šå‘ç”Ÿæ»šåŠ¨ã€‚
ä¾‹å¦‚ï¼š

~~~ javascript
scrollBehavior ï¼ˆto, from, savedPositionï¼‰ {
    return {x: 0, y: 0}
}
~~~

å¯¹äºæ‰€æœ‰è·¯ç”±å¯¼èˆªï¼Œç®€å•åœ°è®©é¡µé¢æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ã€‚

è¿”å› `savedPosition` ï¼Œåœ¨æŒ‰ä¸‹**åé€€/å‰è¿›**æŒ‰é’®æ—¶ï¼Œå°±ä¼šæƒ³æµè§ˆå™¨çš„åŸç”Ÿè¡¨ç°é‚£æ ·ï¼š

~~~ javascript
scrollBehavior (to, from, savedPosition) {
    if (savedPosition) {
        return savedPosition
    } else {
        return {x: 0, y: 0}
    }
}
~~~

å¦‚æœä½ è¦æ¨¡æ‹Ÿâ€œæ»šåŠ¨åˆ°é”šç‚¹â€çš„è¡Œä¸ºï¼Œåˆ™å¯å¦‚ä¸‹ç¼–å†™ä»£ç ï¼š

~~~ javascript
scrollBehavior (to, from, savedPosition) {
    if (to.hash) {
        return {
            selector: to.hash
        }
    }
}
~~~

æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨[è·¯ç”±å…ƒä¿¡æ¯][1]æ›´ç»†é¢—ç²’åº¦åœ°æ§åˆ¶æ»šåŠ¨ã€‚æŸ¥çœ‹å®Œæ•´ä¾‹å­è¯·[ç§»æ­¥è¿™é‡Œ][2]ã€‚

### è·¯ç”±æ‡’åŠ è½½

å½“æ‰“åŒ…æ„å»ºåº”ç”¨æ—¶ï¼ŒJavaScriptåŒ…ä¼šå˜å¾—éå¸¸å¤§ï¼Œä»è€Œå½±å“é¡µé¢çš„åŠ è½½é€Ÿåº¦ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤ŸæŠŠä¸åŒçš„è·¯ç”±å¯¹åº”çš„ç»„ä»¶åˆ†å‰²æˆä¸åŒçš„ä»£ç å—ï¼Œç„¶åå½“è·¯ç”±è¢«è®¿é—®æ—¶é‡‡åŠ è½½å¯¹åº”çš„ç»„ä»¶ï¼Œè¿™æ ·å°±å˜å¾—é«˜æ•ˆäº†ã€‚

ä¸ºäº†æ»¡è¶³ä¸Šé¢çš„è¦æ±‚ï¼Œéœ€è¦ç»“åˆVueçš„[å¼‚æ­¥ç»„ä»¶][9]å’ŒWebpack çš„[ä»£ç åˆ†å‰²åŠŸèƒ½][10]ã€‚

é¦–å…ˆï¼Œéœ€è¦å°†å¼‚æ­¥ç»„ä»¶å®šä¹‰ä¸ºä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå¹¶ä¸”è¯¥å·¥å‚å‡½æ•°è¿”å›ä¸€ä¸ªPromiseï¼ˆè¯¥å‡½æ•°è¿”å›çš„Promiseåº”æ˜¯resolveç»„ä»¶æœ¬èº«ï¼‰ï¼š

~~~ javascript
const Foo = () => Promise.resolve({/*ç»„ä»¶å®šä¹‰å¯¹è±¡*/})
~~~

ç¬¬äºŒï¼Œåœ¨Webpack2ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[åŠ¨æ€ import][11]è¯­æ³•æ¥å®šä¹‰ä»£ç åˆ†å—ç‚¹ï¼ˆsplit pointï¼‰ï¼š

~~~ javascript
import('./Foo.vue')
~~~

å°†å‰é¢ä¸¤æ­¥ç›¸ç»“åˆï¼Œå³ä¸ºå¦‚ä¸‹ä»£ç ï¼Œå°±å®šä¹‰äº†ä¸€ä¸ªèƒ½å¤Ÿè¢«Webpackè‡ªåŠ¨è¿›è¡Œä»£ç åˆ†å‰²çš„å¼‚æ­¥ç»„ä»¶ï¼š

~~~ javascript
const Foo = () => import('./Foo.vue')
~~~

ç„¶ååœ¨è·¯ç”±routerå®ä¾‹ä¸­ç›´æ¥å¼•ç”¨ `Foo`ï¼Œæˆ–è€…ç›´æ¥åœ¨routerå®ä¾‹ä¸­ä½¿ç”¨ `import` è¯­æ³•:

~~~ javascript
const router = new VueRouter({
    routers: [{
        path: '/foo',
        component: () => import('./Foo.vue')
        }
    ]
})
~~~

#### æŒ‰ç»„åˆ†å—

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†åŒä¸ªè·¯ç”±ä¸‹çš„æ‰€æœ‰ç»„ä»¶è£…å…¥åŒä¸€ä¸ª**å¼‚æ­¥å—**(async chunk)ä¸­ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨[**å‘½åå—**][12](named chunks)ï¼Œå‘½åå—é€šè¿‡ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„ **`æ³¨é‡Šè¯­æ³•`** æ¥æä¾›ä¸€ä¸ª**å—åç§°**(chunk name)(webpackç‰ˆæœ¬éœ€è¦é«˜äº2.4)ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

~~~ javascript
const Foo = () => import(/* webpackChunkName: "group-foo" */ './Foo.vue')
const Bar = () => import(/* webpackChunkName: "group-foo" */ './Bar.vue')
const Baz = () => import(/* webpackChunkName: "group-foo" */ './Baz.vue')
~~~

è¿™æ ·webpackä¼šå°†å…·æœ‰åŒä¸€**å—åç§°**(chunk name)çš„æ‰€æœ‰å¼‚æ­¥æ¨¡å—(ç»„ä»¶)è£…å…¥åŒä¸€ä¸ª**å¼‚æ­¥å—**(async chunk)ä¸­ã€‚

TODO å¾…ç»­ï¼è§[7]

[1]:https://segmentfault.com/a/1190000012578301
[2]:https://github.com/vuejs/vue-router/blob/next/examples/scroll-behavior/app.js
[3]:https://endual.iteye.com/blog/1340359
[4]:https://developer.mozilla.org/zh-CN/docs/Web
[5]:https://ssr.vuejs.org/zh/
[6]:http://www.hangge.com/blog/cache/detail_2130.html
[7]:https://juejin.im/post/5b73a50df265da27f7590737
[8]:https://github.com/vuejs/vue-router/blob/next/examples/scroll-behavior/app.js
[9]:https://cn.vuejs.org/v2/guide/components-dynamic-async.html#%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6
[10]:https://doc.webpack-china.org/guides/code-splitting-async/#require-ensure-/
[11]:https://github.com/tc39/proposal-dynamic-import
[12]:https://webpack.js.org/guides/code-splitting-async/#chunk-names
[13]:https://cn.vuejs.org/guide/transitions.html
